{% extends "AdmingeneratorGeneratorBundle:Form:fields.html.twig" %}
{% block autocomplete_js %} 
<script type="text/javascript">

    (function() {
        $('#{{ form.name.vars.id }}').autocomplete('{{ path (autocompleteActionRouting) }}', {
            minChars: {{ minChars }},
            delimiter: /(,|;)\s*/,
            maxHeight: {{ maxHeight }},
            width: {{ width }},
            zIndex: 9999,
            deferRequestBy: {{ deferRequestBy }},
            dataType: "json",
            extraParams: {
                {{ extraParamsString | raw }}
            },
            onItemSelect: function(row) {


                    {# Для использования json данных необходимо в Контроллере,
                       который возвращает данные для выпадающего списка возвращать данные в следующем формате

$Строка_отображения_во_время_набора_с_клавиатуры . "|" . $Строка_которая_подставиться_при_выборе_из_списка . "|" . $Идентификатор . '|' . json_encode($json-данные_для_обработки_в_скрипте)

                    Сюда данные прийдут в переменной row.extra[2]
                    Для превращения их в Javascript-массив выполняем следующее

                    value1 = eval('('+row.extra[2]+')');

                    После чего в value1 у нас javascript-массив, к елементам которго можно обращатся value1.ключ_в_массиве

                    #}
                var json_data = eval('(' + row.extra[2] + ')');

                $('#{{ form.name.vars.id }}').closest('tr').find('.price').val(json_data.cost);
                $('#{{ form.name.vars.id }}').closest('tr').find('.assemblyCost').val(json_data.assemblyCost);
                $('#{{ form.name.vars.id }}').closest('tr').find('.quantity').val("1");

                $('#{{ form.name.vars.id }}').val(row.extra[0]);
                $('#{{ form.id.vars.id }}').val(row.extra[1]);

                    {{ afterItemSelectJavascript | raw }}
                recalcTotal();
            }

        }).change(function() {
            if (!$.trim(this.value)) {
                $('#{{ form.id.vars.id }}').val('').change();
            }

        });
    })();
</script>
{% endblock autocomplete_js %} 
{#
    {% endspaceless %}
{% endblock ajax_autocomplete_widget %}#}
